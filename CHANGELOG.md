# 📋 更新日志

## v2.2.0 - 配置系统完善与新模型集成 (2025-08-27)

### 🚀 新模型支持
- ✅ **6个Copilot模型集成**
  - HKGAI-V1-PROD / HKGAI-V1-Thinking-PROD (生产环境)
  - HKGAI-V1-TEST / HKGAI-V1-Thinking-TEST (测试环境)
  - HKGAI-V1-NET / HKGAI-V1-Thinking-NET (备用环境)
  - 支持Cookie认证和SSE流式响应

### 🔧 配置系统升级
- ✅ **完善的配置管理**
  - 新增Copilot模型配置项（COPILOT_COOKIE_*）
  - Gemini API优化配置（并发数、输出token限制）
  - 智能配置检查和验证功能

- ✅ **配置状态监控**
  - `check_api_keys()`: 检查必需API密钥
  - `check_copilot_models()`: 检查Copilot模型状态
  - `get_model_availability()`: 获取所有模型可用性
  - `print_configuration_status()`: 完整配置状态显示

### 🏗️ 架构重构
- ✅ **模块化设计**
  - 模型客户端分离 (Legacy / Copilot)
  - 统一的模型工厂管理
  - 清晰的代码组织结构

### 🎯 用户体验改进
- ✅ **启动体验优化**
  - 应用启动时自动显示配置状态
  - 清晰的必需/可选配置区分
  - 详细的配置建议和提示

- ✅ **文档完善**
  - 更新配置模板和说明
  - 新增Copilot模型配置指南
  - 完善环境变量文档

### 🐛 错误处理改进
- ✅ **Gemini API增强**
  - 更好的MAX_TOKENS处理
  - 智能重试机制
  - 详细的错误诊断信息

## v2.1.1 - 报告格式优化 (2025-08-26)

### 🔄 功能改进

#### 完整报告格式升级
- ✅ **Excel格式报告** (`/api/generate_report/<filename>/excel`)
  - 多工作表结构：原始数据、统计摘要、模型性能对比、分数分布统计
  - 专业的数据组织和格式化
  - 便于进一步分析和展示

- ✅ **CSV格式报告** (`/api/generate_report/<filename>/csv`) 
  - 增强的CSV格式，包含统计信息
  - 兼容性好，轻量级格式
  - 易于导入其他分析工具

#### 用户界面优化
- ✅ **双格式下载按钮**
  - Excel报告按钮（绿色，主推荐）
  - CSV报告按钮（灰色，备选）
  - 清晰的格式标识图标

- ✅ **改进的用户体验**
  - 格式特定的加载提示
  - 美化的按钮布局和样式
  - 悬停动画效果

### 📊 报告内容结构

#### Excel报告 (4个工作表)
```
📊 原始数据           - 完整的评测数据
📈 统计摘要           - 基础统计和质量指标  
🏆 模型性能对比       - 排名、评分、一致性
📉 分数分布统计       - 各分数段的分布情况
```

#### CSV报告
```
📋 报告头信息         - 文件名、生成时间
📊 基础统计           - 题目数、模型数、平均分
📄 原始数据           - 完整的评测数据
```

### 🔧 技术实现

- 使用`openpyxl`库生成专业Excel报告
- 支持UTF-8编码，确保中文显示正常
- 自动格式化数字和百分比
- 智能文件命名，包含格式后缀

---

## v2.1.0 - 部署优化与代码重构 (2025-08-26)

### 🚀 新增功能

#### 一键部署系统
- ✅ **完整部署脚本** (`deploy.sh`)
  - 支持Ubuntu/Debian、CentOS/RHEL、macOS系统
  - 自动检测操作系统并安装依赖
  - 自动配置Nginx反向代理
  - 自动创建Systemd服务
  - 支持SSL证书自动配置
  - 智能化环境变量配置

- ✅ **详细部署文档** (`DEPLOYMENT.md`)
  - 系统要求和推荐配置
  - 手动安装步骤详解
  - Nginx配置最佳实践
  - SSL/HTTPS配置指南
  - 性能优化建议
  - 监控和日志配置
  - 故障排查指南

- ✅ **快速开始指南** (`QUICK_START.md`)
  - 5分钟快速部署流程
  - 一键部署命令
  - 必需配置说明
  - 生产环境管理命令

#### 配置管理优化
- ✅ **环境配置模板** (`config.env.template`)
  - 详细的配置项说明
  - 分类组织的配置选项
  - 安全最佳实践指导
  - 开发/生产环境区分

#### 完整报告与导出功能
- ✅ **完整报告生成** (`/api/generate_report/<filename>`)
  - 使用AdvancedAnalytics引擎生成详细分析报告
  - 包含基础统计、模型性能排名、质量指标
  - 格式化文本报告，便于存档和分享

- ✅ **筛选结果导出** (`/api/export_filtered`)
  - 支持导出当前页面的筛选数据
  - 智能文件命名（包含筛选条件）
  - CSV格式，便于进一步分析

### 🔧 代码质量改进

#### 变量命名优化
- ✅ **数据库游标变量重命名**
  - `cursor` → `db_cursor` (更具描述性)
  - 涉及文件：`database.py`、`history_manager.py`、`comparison_analysis.py`
  - 提高代码可读性和维护性

#### 评分系统更新
- ✅ **评分范围标准化** (0-5分制)
  - 前端输入验证：支持0分输入
  - 后端API验证：接受0-5分范围
  - 数据库字段：更新注释说明
  - 统计分析：0分计入有效评分
  - 文档更新：所有说明统一为0-5分

### 🎨 用户体验优化

#### 界面显示改进
- ✅ **返回按钮样式优化**
  - 高对比度设计（白色文字+蓝色背景）
  - 现代化圆角和阴影效果
  - 悬停动画和视觉反馈
  - 统一应用于所有页面

#### 功能完善
- ✅ **历史记录下载修复**
  - 新增 `/api/history/download/<result_id>` 路由
  - 智能文件路径检测
  - 兼容新旧文件存储格式
  - 完善错误处理

- ✅ **实时数据更新**
  - 评分修改后自动刷新统计分析
  - 更新分数分布图表
  - 重新计算模型性能排名
  - 优化用户交互体验

### 🛠️ 技术架构改进

#### 部署架构
```
用户请求 → Nginx (反向代理) → Flask应用 (Gunicorn) → SQLite数据库
         ↓
      静态文件直接服务
```

#### 服务管理
- Systemd服务自动管理
- 日志轮转和监控
- 自动备份脚本
- 健康检查端点

#### 安全增强
- HTTPS/SSL支持
- 安全Header配置
- 文件上传大小限制
- 路径遍历保护

### 📁 文件结构变更

#### 新增文件
```
├── deploy.sh                 # 一键部署脚本
├── DEPLOYMENT.md            # 详细部署文档
├── QUICK_START.md           # 快速开始指南
├── config.env.template      # 环境配置模板
├── CHANGELOG.md             # 更新日志 (本文件)
└── backup.sh               # 自动备份脚本 (部署时生成)
└── update.sh               # 应用更新脚本 (部署时生成)
```

#### 核心API新增
```
GET  /api/generate_report/<filename>     # 生成完整报告
POST /api/export_filtered               # 导出筛选结果
GET  /api/history/download/<result_id>  # 历史记录下载
```

### 🐛 问题修复

#### 显示问题
- ✅ 修复 "平均耗时显示未知" 问题
- ✅ 修复 "A+等级字体颜色不可见" 问题  
- ✅ 修复 "0分评分不显示" 问题
- ✅ 修复 "返回主页按钮显示不清楚" 问题

#### 功能问题
- ✅ 修复 "历史记录下载404错误" 问题
- ✅ 修复 "local variable 'os' referenced before assignment" 错误
- ✅ 完善 "下载完整报告和导出筛选结果" 功能

#### 数据处理
- ✅ 优化分数分布统计显示
- ✅ 改进评分修改的实时更新
- ✅ 统一评分范围为0-5分制

### 🔄 兼容性

#### 向后兼容
- ✅ 保持原有API接口不变
- ✅ 兼容现有数据库结构
- ✅ 支持旧版本结果文件格式

#### 升级路径
- ✅ 平滑升级，无需数据迁移
- ✅ 渐进式功能启用
- ✅ 配置文件向前兼容

### 📈 性能优化

#### 前端优化
- 防抖搜索，减少API调用
- 分页显示，提高大数据集渲染性能
- 异步加载，改善用户体验

#### 后端优化
- 数据库连接池管理
- 文件操作异常处理
- API响应缓存机制

### 🚧 已知限制

- 暂不支持分布式部署
- 数据库仅支持SQLite（可扩展）
- 文件存储暂不支持云存储

### 📞 技术支持

- **部署问题**: 参考 `DEPLOYMENT.md` 故障排查章节
- **配置问题**: 参考 `config.env.template` 详细说明
- **功能问题**: 查看 `FEATURE_SUMMARY.md` 功能说明
- **问题反馈**: 提交到项目Issue页面

---

## 下一个版本规划 (v2.2.0)

### 计划功能
- [ ] 分布式部署支持
- [ ] PostgreSQL/MySQL数据库支持  
- [ ] 云存储集成 (AWS S3, 阿里云OSS)
- [ ] 用户权限管理系统
- [ ] API文档自动生成
- [ ] 性能监控Dashboard
- [ ] 微服务架构重构

### 技术债务
- [ ] 单元测试覆盖率提升
- [ ] 前端框架现代化 (考虑Vue.js/React)
- [ ] API版本化管理
- [ ] 缓存策略优化

---

🎉 **v2.1.0版本为AI模型评测系统带来了生产级的部署能力和更好的用户体验！**
