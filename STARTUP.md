# 模型评测Web系统 - 启动指南

## 🚀 快速启动

### 1. 开发环境启动（推荐）

```bash
# 直接启动（前台运行，便于调试）
./start.sh

# 指定端口启动
./start.sh --port 9000

# 启用详细日志
./start.sh --verbose

# 禁用详细日志
./start.sh --quiet
```

### 2. 后台启动（生产环境）

```bash
# 启动后台服务
./start_background.sh start

# 查看运行状态
./start_background.sh status

# 查看日志
./start_background.sh logs

# 停止服务
./start_background.sh stop

# 重启服务
./start_background.sh restart
```

## ⚙️ 日志控制

系统支持**三种方式**控制详细日志输出：

### 方式1：环境变量（临时）
```bash
# 启用详细日志
ENABLE_VERBOSE_LOGGING=true ./start.sh

# 禁用详细日志
ENABLE_VERBOSE_LOGGING=false ./start.sh
```

### 方式2：命令行参数
```bash
# 启用详细日志
./start.sh --verbose

# 禁用详细日志
./start.sh --quiet
```

### 方式3：管理后台（推荐，支持动态切换）
1. 访问系统管理后台
2. 进入 **系统配置管理**
3. 找到 `enable_verbose_logging` 配置项
4. 修改值为 `true`（启用）或 `false`（禁用）
5. **无需重启**，立即生效

## 📋 详细日志内容

启用详细日志后，系统会输出：

### 🔍 评测上下文信息
```
============================================================
📋 [评测上下文] 第1题 (objective模式)
❓ 问题: 北京是中国的首都吗？
✅ 标准答案: 是
🤖 模型数量: 2
   - HKGAI-V1: 是的，北京是中华人民共和国的首都...
   - HKGAI-V2: 北京确实是中国的首都，自1949年以来...
============================================================
```

### 📤 Google API请求详情
```
================================================================================
📤 [Google Gemini API] 发送Prompt到: https://gemini-proxy.hkgai.net/v1beta/models/gemini-2.5-flash:generateContent
🔑 [API密钥] AIzaSyB1X2...k3L4
🎯 [模型名称] gemini-2.5-flash
📋 [最终Prompt内容]:
----------------------------------------
你是一位专业的大模型测评工程师，请根据以下要求对模型的回答进行客观、公正的评测：
...
----------------------------------------
⚙️ [生成配置] 温度: 0.1, 最大令牌: 8192
================================================================================
```

### 📨 Google API响应详情
```
================================================================================
📨 [Google Gemini API] 响应内容:
----------------------------------------
{
  "模型1": {
    "评分": 1,
    "理由": "模型回答与参考答案一致，正确指出北京是中国的首都。",
    "准确性": "正确"
  }
}
----------------------------------------
📏 [响应长度] 285 字符
================================================================================
```

## 🛠️ 配置说明

### start.sh 配置选项
- `-p, --port PORT`: 指定端口（默认：8080）
- `-h, --host HOST`: 指定主机地址（默认：0.0.0.0）
- `-v, --verbose`: 启用详细日志
- `-q, --quiet`: 禁用详细日志
- `--help`: 显示帮助信息

### start_background.sh 配置
编辑脚本顶部的配置区域：
```bash
APP_DIR="/path/to/your/project"     # 项目路径
ENV_NAME="myenv"                    # 虚拟环境名称
HOST="0.0.0.0"                     # 绑定地址
PORT="8080"                         # 绑定端口
```

## 📁 日志文件位置

使用后台启动时，日志文件位于：
- 应用日志：`logs/app.log`
- 访问日志：`logs/access.log` 
- 错误日志：`logs/error.log`

## 🔧 环境要求

### Python依赖
- Python 3.7+
- Flask及相关依赖（见requirements.txt）

### 虚拟环境支持
- **Conda环境**：自动检测并激活
- **venv环境**：自动检测并激活
- **系统环境**：直接使用系统Python

## 💡 使用建议

1. **开发调试**：使用 `./start.sh --verbose` 查看详细日志
2. **生产部署**：使用 `./start_background.sh start` 后台运行
3. **问题排查**：通过管理后台动态启用详细日志
4. **性能优化**：生产环境可禁用详细日志以提升性能

## 🆘 常见问题

### Q: 启动失败怎么办？
A: 
1. 检查Python环境和依赖：`pip install -r requirements.txt`
2. 检查端口是否被占用：`netstat -tlnp | grep 8080`
3. 查看启动日志：`./start_background.sh logs`

### Q: 如何修改默认端口？
A: 
1. 临时修改：`./start.sh --port 9000`
2. 环境变量：`PORT=9000 ./start.sh`
3. 编辑脚本：修改脚本中的PORT变量

### Q: 日志开关不生效？
A: 
1. 确认使用管理后台修改配置
2. 检查数据库中的配置：系统配置管理
3. 重启服务：`./start_background.sh restart`
